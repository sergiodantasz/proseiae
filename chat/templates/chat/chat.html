{% extends "allauth/layouts/base.html" %}
{% load static heroicons %}
{% block content %}
  <div class="max-w-2xl mx-auto min-h-[calc(100dvh-180px)] max-h-[calc(100dvh-180px)] rounded-2xl shadow-xl border border-base-300 flex flex-col">
    <div class="p-4 rounded-t-2xl flex items-center gap-4 flex-wrap border-b border-base-300">
      {% if chat.chat_type == "private" %}
        <a href="{% url "users:profile_detail" other_user.username %}"
           class="flex w-fit items-center gap-2 link link-hover decoration-primary underline-offset-2 mr-auto">
          {% include "account/partials/_avatar.html" with request_user=other_user avatar_size=40 %}
          <div class="flex items-center gap-1">
            <span class="font-bold">{{ other_user.profile.name }}</span>
            <span class="opacity-50">@{{ other_user.username }}</span>
          </div>
        </a>
        <div id="online_user_status" class="hidden"></div>
      {% elif chat.chat_type = "group" %}
      {% else %}
        <div class="flex items-center gap-2 whitespace-nowrap mr-auto">
          {% heroicon_solid "globe-alt" %}
          <h1 class="font-bold text-lg">Chat Geral</h1>
        </div>
        <div class="badge badge-soft badge-success whitespace-nowrap">
          <div class="inline-grid *:[grid-area:1/1]">
            <div class="status status-success animate-ping"></div>
            <div class="status status-success"></div>
          </div>
          <div>
            <span id="online_users_count" class="loading loading-dots loading-xs"></span>
            <span>online</span>
          </div>
        </div>
      {% endif %}
    </div>
    <div id="messages_container" class="p-4 overflow-y-auto">
      {% for message in chat_messages %}
        {% include "chat/partials/_message-item.html" %}
      {% empty %}
        <div id="empty_chat_alert"
             class="alert alert-info alert-soft w-fit mx-auto">
          {% heroicon_outline "information-circle" %}
          <span>Este chat n√£o possui nenhuma mensagem.</span>
        </div>
      {% endfor %}
    </div>
    <div class="mt-auto rounded-b-2xl p-4 border-t border-base-300">
      <form action="{% url "chat:chat" chat.identifier %}"
            id="message_form"
            method="post"
            class="flex gap-2"
            hx-ext="ws"
            ws-connect="/ws/chat/{{ chat.identifier }}/"
            ws-send>
        {% csrf_token %}
        {{ form.content }}
        <button type="submit" class="btn btn-square">{% heroicon_solid "paper-airplane" %}</button>
      </form>
    </div>
  </div>
  <script src="{% static "chat/js/chat-messages.js" %}"></script>
{% endblock content %}
